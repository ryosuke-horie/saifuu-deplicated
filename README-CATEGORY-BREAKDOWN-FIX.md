# カテゴリ内訳チャート：収入/支出切り替え問題の解決

## 問題の概要

ダッシュボードのカテゴリ内訳チャートで「収入」と「支出」の切り替えが機能しない問題が報告されていました。

## 根本原因

調査の結果、**コンポーネント自体は正しく実装されており**、問題はデータの欠如でした：

- サンプルデータが2024年12月の日付で作成されている
- チャートは現在月（2025年6月）のデータのみを表示する
- そのため、どの取引タイプを選択してもデータが0件となり、切り替えが見えない

## 解決方法

### 1. サンプルデータの適用

提供されたSQLファイル（`fix-sample-data.sql`）を実行して、現在月のサンプル取引データを追加します：

```bash
# データベースにサンプルデータを挿入
# 実際の方法は使用しているデータベース環境により異なります

# 例：SQLiteを直接使用する場合
sqlite3 your_database.db < fix-sample-data.sql

# 例：Cloudflare D1を使用する場合  
wrangler d1 execute saifuu-db --file=fix-sample-data.sql

# 例：開発環境のマイグレーション経由
# サンプルデータをseed.sqlに追加して再実行
```

### 2. 追加されるデータの内容

**支出データ（合計: 約¥200,000）**
- 食費: ¥27,400 (10件)
- 住居費: ¥106,500 (5件)
- 交通費: ¥13,280 (5件)
- エンターテイメント: ¥13,500 (5件)
- 健康・医療: ¥15,200 (4件)

**収入データ（合計: ¥455,200）**
- 給与関連: ¥330,000 (3件)
- 副業: ¥73,000 (4件)
- 投資・その他: ¥8,700 (3件)
- 一時収入: ¥23,500 (3件)

## 確認方法

### 1. ダッシュボードで動作確認

1. アプリケーションを起動: `pnpm dev`
2. ブラウザで `http://localhost:5173/` にアクセス
3. カテゴリ別内訳セクションで「支出」/「収入」ボタンをクリック
4. 異なるチャートが表示されることを確認

### 2. 期待される表示

**支出ビュー**: 
- 住居費が最大（約53%）
- 食費が2番目（約14%）
- その他の生活費が適切に分散

**収入ビュー**:
- 給与が最大（約72%）
- 副業が2番目（約16%）
- その他収入が少額で分散

### 3. デバッグ情報の確認

開発環境では、データがない場合にデバッグ情報が表示されます：
- 取引件数
- 選択中のタイプ
- 対象月
- サンプル取引（あれば）

## API確認方法（オプション）

```bash
# 支出データの確認
curl "http://localhost:5173/api/transactions?type=expense&from=2025-06-01&to=2025-06-30"

# 収入データの確認  
curl "http://localhost:5173/api/transactions?type=income&from=2025-06-01&to=2025-06-30"
```

## 技術的詳細

### 実装確認済み項目
- ✅ 収入/支出切り替えUI
- ✅ 状態管理とAPIフィルタリング
- ✅ データ集計とチャート描画
- ✅ エラーハンドリング
- ✅ レスポンシブデザイン
- ✅ TypeScript型安全性

### アーキテクチャ
1. **UI層**: ボタンクリックで`selectedType`状態を更新
2. **フック層**: `useCurrentMonthTransactions`が自動的に再取得
3. **API層**: `/api/transactions`でtypeフィルターを適用
4. **データ層**: データベースクエリでWHERE type = ?フィルタリング

## トラブルシューティング

### 切り替えが機能しない場合

1. **ブラウザの開発者ツールを確認**
   - コンソールエラーの有無
   - ネットワークタブでAPI呼び出しを確認

2. **デバッグ情報を確認**
   - 取引件数が0でないか
   - 対象月が正しいか

3. **データベースを直接確認**
   ```sql
   SELECT type, COUNT(*) as count, SUM(amount) as total
   FROM transactions  
   WHERE transaction_date >= '2025-06-01' 
   AND transaction_date <= '2025-06-30'
   GROUP BY type;
   ```

## まとめ

この問題は**データ不足**が原因であり、コンポーネントの実装は正常でした。提供されたサンプルデータを適用することで、収入/支出切り替え機能が正常に動作することを確認できます。